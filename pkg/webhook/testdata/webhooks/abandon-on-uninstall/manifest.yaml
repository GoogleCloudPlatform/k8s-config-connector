apiVersion: v1
kind: Service
metadata:
  name: abandon-on-uninstall
  namespace: cnrm-system
spec:
  ports:
  - port: 443
    targetPort: 443
  selector:
    cnrm.cloud.google.com/component: cnrm-deletiondefender
    cnrm.cloud.google.com/system: "true"

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    cnrm.cloud.google.com/system: "true"
  annotations:
    cnrm.cloud.google.com/inject-ca:  abandon-on-uninstall.cnrm-system
  name: abandon-on-uninstall.cnrm.cloud.google.com
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    service:
      name: abandon-on-uninstall
      namespace: cnrm-system
      path: /abandon-on-uninstall
  failurePolicy: Fail
  name: abandon-on-uninstall.cnrm.cloud.google.com
  objectSelector:
    matchLabels:
      cnrm.cloud.google.com/managed-by-kcc: no-op
  rules:
  - apiGroups:
    - apiextensions.k8s.io
    apiVersions:
    - v1
    operations:
    - DELETE
    resources:
    - customresourcedefinitions
  sideEffects: NoneOnDryRun
