apiVersion: compute.cnrm.cloud.google.com/v1beta1
kind: ComputeURLMap
metadata:
  name: computeurlmap-kompanion-${uniqueId}
spec:
  location: global
  defaultService:
    backendServiceRef:
      name: computeurlmap-kompanion-default-${uniqueId}
  hostRule:
    - description: Host rule for chaosmonkey.cloudnetworks.x.gcpnp.anz
      hosts:
        - chaosmonkey.cloudnetworks.x.gcpnp.anz
        - chaosmonkey.cloudnetworks.x.gcpnp.anz:*
      pathMatcher: chaosmonkey-cloudnetworks-x-gcpnp-anz
    - description: Host rule for chaosmonkeymulti.cloudnetworks.x.gcpnp.anz
      hosts:
        - chaosmonkeymulti.cloudnetworks.x.gcpnp.anz
        - chaosmonkeymulti.cloudnetworks.x.gcpnp.anz:*
      pathMatcher: chaosmonkeymulti-cloudnetworks-x-gcpnp-anz
    - hosts:
        - svc.gcp.anz
      pathMatcher: computeurlmap-kompanion-default
  pathMatcher:
    - name: chaosmonkey-cloudnetworks-x-gcpnp-anz
      defaultService:
        backendServiceRef:
          name: computeurlmap-kompanion-chaosmonkey-${uniqueId}
      routeRules:
        - priority: 1
          matchRules:
            - prefixMatch: /status/*
          routeAction:
            weightedBackendServices:
              - backendServiceRef:
                  name: computeurlmap-kompanion-chaosmonkey-${uniqueId}
                weight: 500
    - name: chaosmonkeymulti-cloudnetworks-x-gcpnp-anz
      defaultService:
        backendServiceRef:
          name: computeurlmap-kompanion-chaosmonkeymulti-${uniqueId}
      routeRules:
        - priority: 1
          matchRules:
            - prefixMatch: /helloworld
          routeAction:
            weightedBackendServices:
              - backendServiceRef:
                  name: computeurlmap-kompanion-chaosmonkeymulti-${uniqueId}
                weight: 500
    - name: computeurlmap-kompanion-default
      defaultService:
        backendServiceRef:
          name: computeurlmap-kompanion-default-${uniqueId}