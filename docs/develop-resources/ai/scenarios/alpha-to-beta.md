# Promote a Direct Resource from Alpha to Beta (AI-assisted-workflow)

This guide explains how to promote an existing direct resource from `v1alpha1` to `v1beta1` using the Gemini CLI.

> **Note:** If the resource is still using the legacy Terraform or DCL controller, you must first migrate it to the direct approach. Please follow the [migration guide](./migrate-tf-resource-beta.md) before proceeding.

## 1. Instruct Gemini

Use the following prompt to instruct Gemini to promote the resource.

**Prompt:**
```
Promote the `<Kind>` resource from `v1alpha1` to `v1beta1`, following guide @docs/ai/how-to-promote-resource.md

Example:
Promote the `StorageBucketLock` resource from `v1alpha1` to `v1beta1`, following guide @docs/ai/how-to-promote-resource.md
```

---

## 2. Understand the Process

Gemini will handle all the file copying, updating, and configuration changes required for the promotion.

### What Gemini Will Do for You

1.  **Create New API Version:** Gemini will copy the `v1alpha1` API files for the resource to a new `v1beta1` directory.
2.  **Update Go Packages:** It will update the package name and relevant Go imports in the new `v1beta1` files.
3.  **Set Storage Version:** It will add the `// +kubebuilder:storageversion` annotation to the `v1beta1` Go types file, marking it as the primary version for storage.
4.  **Update Controller:** The direct controller will be updated to import and reconcile the `v1beta1` version of the resource.
5.  **Update Test Fixtures:** All MockGCP test files (`create.yaml`, `update.yaml`, `dependencies.yaml`) will be updated to use the new `apiVersion`.
6.  **Regenerate CRDs:** Gemini will run the necessary commands to update the resource's CRD to include the `v1beta1` version.
7.  **Make Direct the Default:** It will ensure the direct controller is the default controller for the new `v1beta1` version.
8.  **Handle Release Tasks:** Gemini will also handle other release-related tasks, such as adding samples and generating reference documentation templates.

This entire process is covered in detail in [Deep Dive: Releases](../deep-dives/5-releases.md).

---

## 3. Verify Gemini's Work

Your role is to review the changes to ensure the promotion was successful.

### PR Review Checklist

-   **API Version in Files:** 
    - Check the git diff to ensure that the resource's `apiVersion` in test files and Go code have been correctly updated from `v1alpha1` to `v1beta1`.
    - Verify that the CRD file in `config/crds/` now includes both `v1alpha1` and `v1beta1` versions, and the `v1beta1`
    is marked as the storage version. 
    - Verify that the Go files for the resource under the `apis/.../v1alpha1` directory have been removed.
-   **Tests Pass:** 
    - Ensure that the MockGCP tests pass successfully with the new `v1beta1` version of the resource. The golden logs should not show any unexpected changes beyond the version update. 
    - Update the autogenerated-code. 
```bash
dev/tasks/generate-types-and-mappers
dev/tasks/generate-resource-report

WRITE_GOLDEN_OUTPUT=1 go test ./tests/apichecks/
WRITE_GOLDEN_OUTPUT=1 go test ./tests/releases/
```
