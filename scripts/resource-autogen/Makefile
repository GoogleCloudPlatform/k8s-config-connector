# Copyright 2022 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Use autogen patches to add required configuration which can't be generated by
# magic-modules due to lack of metadata into the auto-generated service mappings.
.PHONY: apply-autogen-patches
apply-autogen-patches:
	# The patch is used to add resource references for the 'parent' field of
	# DataCatalogPolicyTag.
	# DataCatalogPolicyTag's parent is DataCatalogTaxonomy, and
	# DataCatalogTaxonomy has a server-generated resource ID. To inject the
	# resource ID of a DataCatalogTaxonomy into a DataCatalogPolicyTag during
	# the integration test (i.e. one-step application), we need to use the
	# resource reference feature.
	git apply ./hack/servicemappings/datacatalog_policytag_reference_fields.patch
	# The patch is used to add resource references for the 'parent' field of
	# TagsTagValue.
	# TagsTagValue's parent is TagsTagKey, and TagsTagKey has a server-generated
	# resource ID. To inject the resource ID of a TagsTagKey into a TagsTagValue
	# during the integration test (i.e. one-step application), we need to use
	# the resource reference feature.
	git apply ./hack/servicemappings/tags_tagvalue_parent.patch
	# The patch is used to add resource references for the 'parent' field and
	# 'tagValue' field of TagsTagBinding.
	# Both fields are required fields that need the server-generated resource
	# IDs of resources in the values. To properly inject the server-generated
	# resource IDs during the integration test (i.e. one-step application), we
	# need to use the resource reference feature.
	git apply ./hack/servicemappings/tags_tagbinding_reference_fields.patch
	# The patch is used to add resource references for the 'datasetId' field of
	# BigQueryRoutine.
	git apply ./hack/servicemappings/bigquery_routine_reference_field.patch
	# The patch is used to fix the targetField and valueTemplate for
	# 'perimeterNameRef' configuration, and to fix the metadataMapping and
	# resourceID configuration for AccessContextManagerServicePerimeterResource.
	git apply ./hack/servicemappings/accesscontextmanager_serviceperimeterresource.patch
	# The patch is used to add support for ComputeNetworkFirewallPolicyRule in
	# v1alpha1. This is sub resource that uses an int as it's unique ID and that
	# ID might change in the future
	git apply ./hack/servicemappings/compute_network_firewall_policy_rule.patch

