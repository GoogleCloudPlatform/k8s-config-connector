# In: ~/.gemini/commands/release/generate-summary.toml
# Invoked via: /release:generate-summary
# Gemini custom command docs can be found at https://github.com/google-gemini/gemini-cli/blob/main/docs/cli/commands.md#toml-file-format-v1

description = "Generates a detailed summary of changes for a new release."

prelude = """
if ! ./dev/release/generate-crd-diff.sh; then
  echo "Error generating crd_diff.tmp. Aborting."
  exit 1
fi
"""

prompt = """
Please act as a release notes generator for the Config Connector project.
Your task is to analyze the git diff provided below and generate a structured summary based on the provided template.

Here is the template from 'dev/release/template.md':
$(cat dev/release/template.md)

---

Here is the git diff from 'crd_diff.tmp':
$(cat crd_diff.tmp)

---

Please fill in the template with the information you extract from the diff.
Instructions for filling the template:
- **[COUNT]**, **[OLD_VERSION]**, **[NEW_VERSION]**: Determine these from changes to 'cnrm.cloud.google.com/version:' annotations.
- **[RENAMED_FILE_OLD]** and **[RENAMED_FILE_NEW]**: Find file renames from 'v1alpha1' to 'v1beta1'.
- **[NEW_CRD_FILE]**: Find newly created CRD files.
- **[FIELD_NAME]** and **[RESOURCE_NAME]**: Identify newly added fields in the CRD specs.
- **Other Notable Changes**: Summarize any other significant changes from the diff that are not covered by the other sections.
- **Missed Old Versions**: Scan the diff for any instances of the old version number that might have been missed.
"""
