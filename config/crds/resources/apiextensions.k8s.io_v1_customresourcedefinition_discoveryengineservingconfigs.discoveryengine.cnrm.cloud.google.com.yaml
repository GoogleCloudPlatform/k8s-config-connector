apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cnrm.cloud.google.com/version: 0.0.0-dev
  creationTimestamp: null
  labels:
    cnrm.cloud.google.com/managed-by-kcc: "true"
    cnrm.cloud.google.com/system: "true"
  name: discoveryengineservingconfigs.discoveryengine.cnrm.cloud.google.com
spec:
  group: discoveryengine.cnrm.cloud.google.com
  names:
    categories:
    - gcp
    kind: DiscoveryEngineServingConfig
    listKind: DiscoveryEngineServingConfigList
    plural: discoveryengineservingconfigs
    shortNames:
    - gcpdiscoveryengineservingconfig
    - gcpdiscoveryengineservingconfigs
    singular: discoveryengineservingconfig
  preserveUnknownFields: false
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: When 'True', the most recent reconcile of the resource succeeded
      jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - description: The reason for the value in 'Ready'
      jsonPath: .status.conditions[?(@.type=='Ready')].reason
      name: Status
      type: string
    - description: The last transition time for the value in 'Status'
      jsonPath: .status.conditions[?(@.type=='Ready')].lastTransitionTime
      name: Status Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: DiscoveryEngineServingConfig is the Schema for the DiscoveryEngineServingConfig
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: DiscoveryEngineServingConfigSpec defines the desired state
              of DiscoveryEngineServingConfig
            properties:
              boostControlIds:
                description: Boost controls to use in serving path. All triggered
                  boost controls will be applied. Boost controls must be in the same
                  data store as the serving config. Maximum of 20 boost controls.
                items:
                  type: string
                type: array
              displayName:
                description: |-
                  Required. The human readable serving config display name. Used in Discovery
                   UI.

                   This field must be a UTF-8 encoded string with a length limit of 128
                   characters. Otherwise, an INVALID_ARGUMENT error is returned.
                type: string
              dissociateControlIds:
                description: |-
                  Condition do not associate specifications. If multiple do not
                   associate conditions match, all matching do not associate controls in
                   the list will execute.
                   Order does not matter.
                   Maximum number of specifications is 100.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_SEARCH][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_SEARCH].
                items:
                  type: string
                type: array
              diversityLevel:
                description: |-
                  How much diversity to use in recommendation model results e.g.
                   `medium-diversity` or `high-diversity`. Currently supported values:

                   * `no-diversity`
                   * `low-diversity`
                   * `medium-diversity`
                   * `high-diversity`
                   * `auto-diversity`

                   If not specified, we choose default based on recommendation model
                   type. Default value: `no-diversity`.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_RECOMMENDATION][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_RECOMMENDATION].
                type: string
              embeddingConfig:
                description: Bring your own embedding config. The config is used for
                  search semantic retrieval. The retrieval is based on the dot product
                  of [SearchRequest.EmbeddingSpec.EmbeddingVector.vector][google.cloud.discoveryengine.v1beta.SearchRequest.EmbeddingSpec.EmbeddingVector.vector]
                  and the document embeddings that are provided by this EmbeddingConfig.
                  If [SearchRequest.EmbeddingSpec.EmbeddingVector.vector][google.cloud.discoveryengine.v1beta.SearchRequest.EmbeddingSpec.EmbeddingVector.vector]
                  is provided, it overrides this [ServingConfig.embedding_config][google.cloud.discoveryengine.v1beta.ServingConfig.embedding_config].
                properties:
                  fieldPath:
                    description: Full field path in the schema mapped as embedding
                      field.
                    type: string
                type: object
              filterControlIds:
                description: Filter controls to use in serving path. All triggered
                  filter controls will be applied. Filter controls must be in the
                  same data store as the serving config. Maximum of 20 filter controls.
                items:
                  type: string
                type: array
              genericConfig:
                description: The GenericConfig of the serving configuration.
                properties:
                  contentSearchSpec:
                    description: Specifies the expected behavior of content search.
                      Only valid for content-search enabled data store.
                    properties:
                      chunkSpec:
                        description: Specifies the chunk spec to be returned from
                          the search response. Only available if the [SearchRequest.ContentSearchSpec.search_result_mode][google.cloud.discoveryengine.v1beta.SearchRequest.ContentSearchSpec.search_result_mode]
                          is set to [CHUNKS][google.cloud.discoveryengine.v1beta.SearchRequest.ContentSearchSpec.SearchResultMode.CHUNKS]
                        properties:
                          numNextChunks:
                            description: The number of next chunks to be returned
                              of the current chunk. The maximum allowed value is 3.
                              If not specified, no next chunks will be returned.
                            format: int32
                            type: integer
                          numPreviousChunks:
                            description: The number of previous chunks to be returned
                              of the current chunk. The maximum allowed value is 3.
                              If not specified, no previous chunks will be returned.
                            format: int32
                            type: integer
                        type: object
                      extractiveContentSpec:
                        description: If there is no extractive_content_spec provided,
                          there will be no extractive answer in the search response.
                        properties:
                          maxExtractiveAnswerCount:
                            description: |-
                              The maximum number of extractive answers returned in each search
                               result.

                               An extractive answer is a verbatim answer extracted from the original
                               document, which provides a precise and contextually relevant answer to
                               the search query.

                               If the number of matching answers is less than the
                               `max_extractive_answer_count`, return all of the answers. Otherwise,
                               return the `max_extractive_answer_count`.

                               At most five answers are returned for each
                               [SearchResult][google.cloud.discoveryengine.v1beta.SearchResponse.SearchResult].
                            format: int32
                            type: integer
                          maxExtractiveSegmentCount:
                            description: |-
                              The max number of extractive segments returned in each search result.
                               Only applied if the
                               [DataStore][google.cloud.discoveryengine.v1beta.DataStore] is set to
                               [DataStore.ContentConfig.CONTENT_REQUIRED][google.cloud.discoveryengine.v1beta.DataStore.ContentConfig.CONTENT_REQUIRED]
                               or
                               [DataStore.solution_types][google.cloud.discoveryengine.v1beta.DataStore.solution_types]
                               is
                               [SOLUTION_TYPE_CHAT][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_CHAT].

                               An extractive segment is a text segment extracted from the original
                               document that is relevant to the search query, and, in general, more
                               verbose than an extractive answer. The segment could then be used as
                               input for LLMs to generate summaries and answers.

                               If the number of matching segments is less than
                               `max_extractive_segment_count`, return all of the segments. Otherwise,
                               return the `max_extractive_segment_count`.
                            format: int32
                            type: integer
                          numNextSegments:
                            description: Return at most `num_next_segments` segments
                              after each selected segments.
                            format: int32
                            type: integer
                          numPreviousSegments:
                            description: Specifies whether to also include the adjacent
                              from each selected segments. Return at most `num_previous_segments`
                              segments before each selected segments.
                            format: int32
                            type: integer
                          returnExtractiveSegmentScore:
                            description: Specifies whether to return the confidence
                              score from the extractive segments in each search result.
                              This feature is available only for new or allowlisted
                              data stores. To allowlist your data store, contact your
                              Customer Engineer. The default value is `false`.
                            type: boolean
                        type: object
                      searchResultMode:
                        description: Specifies the search result mode. If unspecified,
                          the search result mode defaults to `DOCUMENTS`.
                        type: string
                      snippetSpec:
                        description: If `snippetSpec` is not specified, snippets are
                          not included in the search response.
                        properties:
                          maxSnippetCount:
                            description: '[DEPRECATED] This field is deprecated. To
                              control snippet return, use `return_snippet` field.
                              For backwards compatibility, we will return snippet
                              if max_snippet_count > 0.'
                            format: int32
                            type: integer
                          referenceOnly:
                            description: '[DEPRECATED] This field is deprecated and
                              will have no affect on the snippet.'
                            type: boolean
                          returnSnippet:
                            description: If `true`, then return snippet. If no snippet
                              can be generated, we return "No snippet is available
                              for this page." A `snippet_status` with `SUCCESS` or
                              `NO_SNIPPET_AVAILABLE` will also be returned.
                            type: boolean
                        type: object
                      summarySpec:
                        description: If `summarySpec` is not specified, summaries
                          are not included in the search response.
                        properties:
                          ignoreAdversarialQuery:
                            description: |-
                              Specifies whether to filter out adversarial queries. The default value
                               is `false`.

                               Google employs search-query classification to detect adversarial
                               queries. No summary is returned if the search query is classified as an
                               adversarial query. For example, a user might ask a question regarding
                               negative comments about the company or submit a query designed to
                               generate unsafe, policy-violating output. If this field is set to
                               `true`, we skip generating summaries for adversarial queries and return
                               fallback messages instead.
                            type: boolean
                          ignoreJailBreakingQuery:
                            description: |-
                              Optional. Specifies whether to filter out jail-breaking queries. The
                               default value is `false`.

                               Google employs search-query classification to detect jail-breaking
                               queries. No summary is returned if the search query is classified as a
                               jail-breaking query. A user might add instructions to the query to
                               change the tone, style, language, content of the answer, or ask the
                               model to act as a different entity, e.g. "Reply in the tone of a
                               competing company's CEO". If this field is set to `true`, we skip
                               generating summaries for jail-breaking queries and return fallback
                               messages instead.
                            type: boolean
                          ignoreLowRelevantContent:
                            description: |-
                              Specifies whether to filter out queries that have low relevance. The
                               default value is `false`.

                               If this field is set to `false`, all search results are used regardless
                               of relevance to generate answers. If set to `true`, only queries with
                               high relevance search results will generate answers.
                            type: boolean
                          ignoreNonSummarySeekingQuery:
                            description: |-
                              Specifies whether to filter out queries that are not summary-seeking.
                               The default value is `false`.

                               Google employs search-query classification to detect summary-seeking
                               queries. No summary is returned if the search query is classified as a
                               non-summary seeking query. For example, `why is the sky blue` and `Who
                               is the best soccer player in the world?` are summary-seeking queries,
                               but `SFO airport` and `world cup 2026` are not. They are most likely
                               navigational queries. If this field is set to `true`, we skip
                               generating summaries for non-summary seeking queries and return
                               fallback messages instead.
                            type: boolean
                          includeCitations:
                            description: |-
                              Specifies whether to include citations in the summary. The default
                               value is `false`.

                               When this field is set to `true`, summaries include in-line citation
                               numbers.

                               Example summary including citations:

                               BigQuery is Google Cloud's fully managed and completely serverless
                               enterprise data warehouse [1]. BigQuery supports all data types, works
                               across clouds, and has built-in machine learning and business
                               intelligence, all within a unified platform [2, 3].

                               The citation numbers refer to the returned search results and are
                               1-indexed. For example, [1] means that the sentence is attributed to
                               the first search result. [2, 3] means that the sentence is attributed
                               to both the second and third search results.
                            type: boolean
                          languageCode:
                            description: 'Language code for Summary. Use language
                              tags defined by [BCP47](https://www.rfc-editor.org/rfc/bcp/bcp47.txt).
                              Note: This is an experimental feature.'
                            type: string
                          modelPromptSpec:
                            description: If specified, the spec will be used to modify
                              the prompt provided to the LLM.
                            properties:
                              preamble:
                                description: Text at the beginning of the prompt that
                                  instructs the assistant. Examples are available
                                  in the user guide.
                                type: string
                            type: object
                          modelSpec:
                            description: If specified, the spec will be used to modify
                              the model specification provided to the LLM.
                            properties:
                              version:
                                description: |-
                                  The model version used to generate the summary.

                                   Supported values are:

                                   * `stable`: string. Default value when no value is specified. Uses a
                                      generally available, fine-tuned model. For more information, see
                                      [Answer generation model versions and
                                      lifecycle](https://cloud.google.com/generative-ai-app-builder/docs/answer-generation-models).
                                   * `preview`: string. (Public preview) Uses a preview model. For more
                                      information, see
                                      [Answer generation model versions and
                                      lifecycle](https://cloud.google.com/generative-ai-app-builder/docs/answer-generation-models).
                                type: string
                            type: object
                          summaryResultCount:
                            description: |-
                              The number of top results to generate the summary from. If the number
                               of results returned is less than `summaryResultCount`, the summary is
                               generated from all of the results.

                               At most 10 results for documents mode, or 50 for chunks mode, can be
                               used to generate a summary. The chunks mode is used when
                               [SearchRequest.ContentSearchSpec.search_result_mode][google.cloud.discoveryengine.v1beta.SearchRequest.ContentSearchSpec.search_result_mode]
                               is set to
                               [CHUNKS][google.cloud.discoveryengine.v1beta.SearchRequest.ContentSearchSpec.SearchResultMode.CHUNKS].
                            format: int32
                            type: integer
                          useSemanticChunks:
                            description: If true, answer will be generated from most
                              relevant chunks from top search results. This feature
                              will improve summary quality. Note that with this feature
                              enabled, not all top search results will be referenced
                              and included in the reference list, so the citation
                              source index only points to the search results listed
                              in the reference list.
                            type: boolean
                        type: object
                    type: object
                type: object
              ignoreControlIds:
                description: Condition ignore specifications. If multiple ignore conditions
                  match, all matching ignore controls in the list will execute. Order
                  does not matter. Maximum number of specifications is 100.
                items:
                  type: string
                type: array
              location:
                description: Immutable. The location where the TPU virtual machine
                  should reside.
                type: string
              mediaConfig:
                properties:
                  contentFreshnessCutoffDays:
                    description: Specifies the content freshness used for recommendation
                      result. Contents will be demoted if contents were published
                      for more than content freshness cutoff days.
                    format: int32
                    type: integer
                  contentWatchedPercentageThreshold:
                    description: Specifies the content watched percentage threshold
                      for demotion. Threshold value must be between [0, 1.0] inclusive.
                    type: number
                  contentWatchedSecondsThreshold:
                    description: Specifies the content watched minutes threshold for
                      demotion.
                    type: number
                  demoteContentWatchedPastDays:
                    description: Optional. Specifies the number of days to look back
                      for demoting watched content. If set to zero or unset, defaults
                      to the maximum of 365 days.
                    format: int32
                    type: integer
                  demotionEventType:
                    description: |-
                      Specifies the event type used for demoting recommendation result.
                       Currently supported values:

                       * `view-item`: Item viewed.
                       * `media-play`: Start/resume watching a video, playing a song, etc.
                       * `media-complete`: Finished or stopped midway through a video, song,
                       etc.

                       If unset, watch history demotion will not be applied. Content freshness
                       demotion will still be applied.
                    type: string
                type: object
              modelID:
                description: |-
                  The id of the model to use at serving time.
                   Currently only RecommendationModels are supported.
                   Can be changed but only to a compatible model (e.g.
                   others-you-may-like CTR to others-you-may-like CVR).

                   Required when
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_RECOMMENDATION][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_RECOMMENDATION].
                type: string
              name:
                description: Immutable. Fully qualified name `projects/{project}/locations/{location}/collections/{collection_id}/engines/{engine_id}/servingConfigs/{serving_config_id}`
                type: string
              onewaySynonymsControlIds:
                description: |-
                  Condition oneway synonyms specifications. If multiple oneway synonyms
                   conditions match, all matching oneway synonyms controls in the list
                   will execute. Maximum number of specifications is 100.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_SEARCH][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_SEARCH].
                items:
                  type: string
                type: array
              personalizationSpec:
                description: |-
                  The specification for personalization spec.

                   Notice that if both
                   [ServingConfig.personalization_spec][google.cloud.discoveryengine.v1beta.ServingConfig.personalization_spec]
                   and
                   [SearchRequest.personalization_spec][google.cloud.discoveryengine.v1beta.SearchRequest.personalization_spec]
                   are set,
                   [SearchRequest.personalization_spec][google.cloud.discoveryengine.v1beta.SearchRequest.personalization_spec]
                   overrides
                   [ServingConfig.personalization_spec][google.cloud.discoveryengine.v1beta.ServingConfig.personalization_spec].
                properties:
                  mode:
                    description: The personalization mode of the search request. Defaults
                      to [Mode.AUTO][google.cloud.discoveryengine.v1beta.SearchRequest.PersonalizationSpec.Mode.AUTO].
                    type: string
                type: object
              projectRef:
                description: The project that the TPU virtual machine belongs to.
                oneOf:
                - not:
                    required:
                    - external
                  required:
                  - name
                - not:
                    anyOf:
                    - required:
                      - name
                    - required:
                      - namespace
                  required:
                  - external
                properties:
                  external:
                    description: The `projectID` field of a project, when not managed
                      by Config Connector.
                    type: string
                  kind:
                    description: The kind of the Project resource; optional but must
                      be `Project` if provided.
                    type: string
                  name:
                    description: The `name` field of a `Project` resource.
                    type: string
                  namespace:
                    description: The `namespace` field of a `Project` resource.
                    type: string
                type: object
              rankingExpression:
                description: |-
                  The ranking expression controls the customized ranking on retrieval
                   documents. To leverage this, document embedding is required. The ranking
                   expression setting in ServingConfig applies to all search requests served
                   by the serving config. However, if
                   [SearchRequest.ranking_expression][google.cloud.discoveryengine.v1beta.SearchRequest.ranking_expression]
                   is specified, it overrides the ServingConfig ranking expression.

                   The ranking expression is a single function or multiple functions that are
                   joined by "+".

                     * ranking_expression = function, { " + ", function };

                   Supported functions:

                     * double * relevance_score
                     * double * dotProduct(embedding_field_path)

                   Function variables:

                     * `relevance_score`: pre-defined keywords, used for measure relevance
                     between query and document.
                     * `embedding_field_path`: the document embedding field
                     used with query embedding vector.
                     * `dotProduct`: embedding function between embedding_field_path and query
                     embedding vector.

                    Example ranking expression:

                      If document has an embedding field doc_embedding, the ranking expression
                      could be `0.5 * relevance_score + 0.3 * dotProduct(doc_embedding)`.
                type: string
              redirectControlIds:
                description: |-
                  IDs of the redirect controls. Only the first triggered redirect
                   action is applied, even if multiple apply. Maximum number of
                   specifications is 100.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_SEARCH][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_SEARCH].
                items:
                  type: string
                type: array
              replacementControlIds:
                description: |-
                  Condition replacement specifications.
                   Applied according to the order in the list.
                   A previously replaced term can not be re-replaced.
                   Maximum number of specifications is 100.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_SEARCH][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_SEARCH].
                items:
                  type: string
                type: array
              resourceID:
                description: The DiscoveryEngineServingConfig name. If not given,
                  the metadata.name will be used.
                type: string
              solutionType:
                description: Required. Immutable. Specifies the solution type that
                  a serving config can be associated with.
                type: string
              synonymsControlIds:
                description: |-
                  Condition synonyms specifications. If multiple synonyms conditions
                   match, all matching synonyms controls in the list will execute.
                   Maximum number of specifications is 100.

                   Can only be set if
                   [SolutionType][google.cloud.discoveryengine.v1beta.SolutionType] is
                   [SOLUTION_TYPE_SEARCH][google.cloud.discoveryengine.v1beta.SolutionType.SOLUTION_TYPE_SEARCH].
                items:
                  type: string
                type: array
            required:
            - location
            - projectRef
            type: object
          status:
            description: DiscoveryEngineServingConfigStatus defines the config connector
              machine state of DiscoveryEngineServingConfig
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the object's current state.
                items:
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      type: string
                    message:
                      description: Human-readable message indicating details about
                        last transition.
                      type: string
                    reason:
                      description: Unique, one-word, CamelCase reason for the condition's
                        last transition.
                      type: string
                    status:
                      description: Status is the status of the condition. Can be True,
                        False, Unknown.
                      type: string
                    type:
                      description: Type is the type of the condition.
                      type: string
                  type: object
                type: array
              externalRef:
                description: A unique specifier for the DiscoveryEngineServingConfig
                  resource in GCP.
                type: string
              observedGeneration:
                description: ObservedGeneration is the generation of the resource
                  that was most recently observed by the Config Connector controller.
                  If this is equal to metadata.generation, then that means that the
                  current reported status reflects the most recent desired state of
                  the resource.
                format: int64
                type: integer
              observedState:
                description: ObservedState is the state of the resource as most recently
                  observed in GCP.
                type: object
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
