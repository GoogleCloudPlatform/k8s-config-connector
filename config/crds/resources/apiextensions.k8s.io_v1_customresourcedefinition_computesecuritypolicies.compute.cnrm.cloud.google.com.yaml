apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cnrm.cloud.google.com/version: 0.0.0-dev
  creationTimestamp: null
  labels:
    cnrm.cloud.google.com/managed-by-kcc: "true"
    cnrm.cloud.google.com/stability-level: stable
    cnrm.cloud.google.com/system: "true"
    cnrm.cloud.google.com/tf2crd: "true"
  name: computesecuritypolicies.compute.cnrm.cloud.google.com
spec:
  group: compute.cnrm.cloud.google.com
  names:
    categories:
    - gcp
    kind: ComputeSecurityPolicy
    listKind: ComputeSecurityPolicyList
    plural: computesecuritypolicies
    shortNames:
    - gcpcomputesecuritypolicy
    - gcpcomputesecuritypolicies
    singular: computesecuritypolicy
  preserveUnknownFields: false
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: ComputeSecurityPolicy is the Schema for the ComputeSecurityPolicy
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              adaptiveProtectionConfig:
                properties:
                  autoDeployConfig:
                    description: Auto Deploy Config of this security policy
                    properties:
                      confidenceThreshold:
                        description: Rules are only automatically deployed for alerts
                          on potential attacks with confidence scores greater than
                          this threshold.
                        type: number
                      expirationSec:
                        description: Google Cloud Armor stops applying the action
                          in the automatically deployed rule to an identified attacker
                          after this duration. The rule continues to operate against
                          new requests.
                        format: int32
                        type: integer
                      impactedBaselineThreshold:
                        description: Rules are only automatically deployed when the
                          estimated impact to baseline traffic from the suggested
                          mitigation is below this threshold.
                        type: number
                      loadThreshold:
                        description: Identifies new attackers only when the load to
                          the backend service that is under attack exceeds this threshold.
                        type: number
                    type: object
                  layer7DdosDefenseConfig:
                    description: Layer 7 DDoS Defense Config of this security policy
                    properties:
                      enable:
                        description: If set to true, enables CAAP for L7 DDoS detection.
                        type: boolean
                      ruleVisibility:
                        description: 'Rule visibility. Supported values include: "STANDARD",
                          "PREMIUM".'
                        type: string
                    type: object
                type: object
              advancedOptionsConfig:
                properties:
                  jsonCustomConfig:
                    description: Custom configuration to apply the JSON parsing. Only
                      applicable when json_parsing is set to STANDARD.
                    properties:
                      contentTypes:
                        description: 'A list of custom Content-Type header values
                          to apply the JSON parsing. As per RFC 1341, a Content-Type
                          header value has the following format: Content-Type := type
                          "/" subtype *[";" parameter] When configuring a custom Content-Type
                          header value, only the type/subtype needs to be specified,
                          and the parameters should be excluded.'
                        items:
                          type: string
                        type: array
                    required:
                    - contentTypes
                    type: object
                  jsonParsing:
                    description: Check the JsonParsing enum for the list of possible
                      values.
                    type: string
                  logLevel:
                    description: Check the LogLevel enum for the list of possible
                      values.
                    type: string
                  userIpRequestHeaders:
                    description: An optional list of case-insensitive request header
                      names to use for resolving the callers client IP address.
                    items:
                      type: string
                    type: array
                type: object
              description:
                type: string
              recaptchaOptionsConfig:
                properties:
                  redirectSiteKeyRef:
                    oneOf:
                    - not:
                        required:
                        - external
                      required:
                      - name
                    - not:
                        anyOf:
                        - required:
                          - name
                        - required:
                          - namespace
                      required:
                      - external
                    properties:
                      external:
                        description: The value of an externally managed RecaptchaEnterpriseKey
                          resource.
                        type: string
                      name:
                        description: The name of a RecaptchaEnterpriseKey resource.
                        type: string
                      namespace:
                        description: The namespace of a RecaptchaEnterpriseKey resource.
                        type: string
                    type: object
                required:
                - redirectSiteKeyRef
                type: object
              resourceID:
                description: The ComputeSecurityPolicy name. If not given, the metadata.name
                  will be used.
                type: string
              rule:
                items:
                  properties:
                    action:
                      description: 'The Action to perform when the rule is matched.
                        The following are the valid actions: - allow: allow access
                        to target. - deny(STATUS): deny access to target, returns
                        the HTTP response code specified. Valid values for `STATUS`
                        are 403, 404, and 502. - rate_based_ban: limit client traffic
                        to the configured threshold and ban the client if the traffic
                        exceeds the threshold. Configure parameters for this action
                        in RateLimitOptions. Requires rate_limit_options to be set.
                        - redirect: redirect to a different target. This can either
                        be an internal reCAPTCHA redirect, or an external URL-based
                        redirect via a 302 response. Parameters for this action can
                        be configured via redirectOptions. This action is only supported
                        in Global Security Policies of type CLOUD_ARMOR. - throttle:
                        limit client traffic to the configured threshold. Configure
                        parameters for this action in rateLimitOptions. Requires rate_limit_options
                        to be set for this.'
                      type: string
                    description:
                      description: An optional description of this resource. Provide
                        this property when you create the resource.
                      type: string
                    headerAction:
                      description: Optional, additional actions that are performed
                        on headers. This field is only supported in Global Security
                        Policies of type CLOUD_ARMOR.
                      properties:
                        requestHeadersToAdds:
                          description: The list of request headers to add or overwrite
                            if they're already present.
                          items:
                            properties:
                              headerName:
                                description: The name of the header to set.
                                type: string
                              headerValue:
                                description: The value to set the named header to.
                                type: string
                            type: object
                          type: array
                      type: object
                    match:
                      description: A match condition that incoming traffic is evaluated
                        against. If it evaluates to true, the corresponding 'action'
                        is enforced.
                      properties:
                        config:
                          description: The configuration options available when specifying
                            versioned_expr. This field must be specified if versioned_expr
                            is specified and cannot be specified if versioned_expr
                            is not specified.
                          properties:
                            srcIpRanges:
                              description: CIDR IP address range. Maximum number of
                                src_ip_ranges allowed is 10.
                              items:
                                type: string
                              type: array
                          required:
                          - srcIpRanges
                          type: object
                        expr:
                          description: User defined CEVAL expression. A CEVAL expression
                            is used to specify match criteria such as origin.ip, source.region_code
                            and contents in the request header. Expressions containing
                            `evaluateThreatIntelligence` require Cloud Armor Managed
                            Protection Plus tier and are not supported in Edge Policies
                            nor in Regional Policies. Expressions containing `evaluatePreconfiguredExpr('sourceiplist-*')`
                            require Cloud Armor Managed Protection Plus tier and are
                            only supported in Global Security Policies.
                          properties:
                            expression:
                              description: Textual representation of an expression
                                in Common Expression Language syntax.
                              type: string
                          type: object
                        versionedExpr:
                          description: 'Preconfigured versioned expression. If this
                            field is specified, config must also be specified. Available
                            preconfigured expressions along with their requirements
                            are: SRC_IPS_V1 - must specify the corresponding src_ip_range
                            field in config. Check the VersionedExpr enum for the
                            list of possible values.'
                          type: string
                      type: object
                    preconfiguredWafConfig:
                      description: Preconfigured WAF configuration to be applied for
                        the rule. If the rule does not evaluate preconfigured WAF
                        rules, i.e., if evaluatePreconfiguredWaf() is not used, this
                        field will have no effect.
                      properties:
                        exclusion:
                          description: A list of exclusions to apply during preconfigured
                            WAF evaluation.
                          items:
                            properties:
                              requestCookie:
                                description: A list of request cookie names whose
                                  value will be excluded from inspection during preconfigured
                                  WAF evaluation.
                                items:
                                  properties:
                                    operator:
                                      description: The match operator for the field.
                                        Check the Op enum for the list of possible
                                        values.
                                      type: string
                                    value:
                                      description: The value of the field.
                                      type: string
                                  type: object
                                type: array
                              requestHeader:
                                description: A list of request header names whose
                                  value will be excluded from inspection during preconfigured
                                  WAF evaluation.
                                items:
                                  properties:
                                    operator:
                                      description: The match operator for the field.
                                        Check the Op enum for the list of possible
                                        values.
                                      type: string
                                    value:
                                      description: The value of the field.
                                      type: string
                                  type: object
                                type: array
                              requestQueryParam:
                                description: A list of request query parameter names
                                  whose value will be excluded from inspection during
                                  preconfigured WAF evaluation. Note that the parameter
                                  can be in the query string or in the POST body.
                                items:
                                  properties:
                                    operator:
                                      description: The match operator for the field.
                                        Check the Op enum for the list of possible
                                        values.
                                      type: string
                                    value:
                                      description: The value of the field.
                                      type: string
                                  type: object
                                type: array
                              requestUri:
                                description: A list of request URIs from the request
                                  line to be excluded from inspection during preconfigured
                                  WAF evaluation. When specifying this field, the
                                  query or fragment part should be excluded.
                                items:
                                  properties:
                                    operator:
                                      description: The match operator for the field.
                                        Check the Op enum for the list of possible
                                        values.
                                      type: string
                                    value:
                                      description: The value of the field.
                                      type: string
                                  type: object
                                type: array
                              targetRuleIds:
                                description: A list of target rule IDs under the WAF
                                  rule set to apply the preconfigured WAF exclusion.
                                  If omitted, it refers to all the rule IDs under
                                  the WAF rule set.
                                items:
                                  type: string
                                type: array
                              targetRuleSet:
                                description: Target WAF rule set to apply the preconfigured
                                  WAF exclusion.
                                type: string
                            type: object
                          type: array
                      type: object
                    preview:
                      description: If set to true, the specified action is not enforced.
                      type: boolean
                    priority:
                      description: An integer indicating the priority of a rule in
                        the list. The priority must be a positive value between 0
                        and 2147483647. Rules are evaluated from highest to lowest
                        priority where 0 is the highest priority and 2147483647 is
                        the lowest priority.
                      format: int32
                      type: integer
                    rateLimitOptions:
                      description: Must be specified if the action is "rate_based_ban"
                        or "throttle". Cannot be specified for any other actions.
                      properties:
                        banDurationSec:
                          description: Can only be specified if the action for the
                            rule is "rate_based_ban". If specified, determines the
                            time (in seconds) the traffic will continue to be banned
                            by the rate limit after the rate falls below the threshold.
                          format: int32
                          type: integer
                        banThreshold:
                          description: Can only be specified if the action for the
                            rule is "rate_based_ban". If specified, the key will be
                            banned for the configured 'ban_duration_sec' when the
                            number of requests that exceed the 'rate_limit_threshold'
                            also exceed this 'ban_threshold'.
                          properties:
                            count:
                              description: Number of HTTP(S) requests for calculating
                                the threshold.
                              format: int32
                              type: integer
                            intervalSec:
                              description: Interval over which the threshold is computed.
                              format: int32
                              type: integer
                          required:
                          - count
                          - intervalSec
                          type: object
                        conformAction:
                          description: Action to take for requests that are under
                            the configured rate limit threshold. Valid option is "allow"
                            only.
                          type: string
                        enforceOnKey:
                          description: 'Determines the key to enforce the rate_limit_threshold
                            on. Possible values are: - ALL: A single rate limit threshold
                            is applied to all the requests matching this rule. This
                            is the default value if "enforceOnKey" is not configured.
                            - IP: The source IP address of the request is the key.
                            Each IP has this limit enforced separately. - HTTP_HEADER:
                            The value of the HTTP header whose name is configured
                            under "enforceOnKeyName". The key value is truncated to
                            the first 128 bytes of the header value. If no such header
                            is present in the request, the key type defaults to ALL.
                            - XFF_IP: The first IP address (i.e. the originating client
                            IP address) specified in the list of IPs under X-Forwarded-For
                            HTTP header. If no such header is present or the value
                            is not a valid IP, the key defaults to the source IP address
                            of the request i.e. key type IP. - HTTP_COOKIE: The value
                            of the HTTP cookie whose name is configured under "enforceOnKeyName".
                            The key value is truncated to the first 128 bytes of the
                            cookie value. If no such cookie is present in the request,
                            the key type defaults to ALL. - HTTP_PATH: The URL path
                            of the HTTP request. The key value is truncated to the
                            first 128 bytes. - SNI: Server name indication in the
                            TLS session of the HTTPS request. The key value is truncated
                            to the first 128 bytes. The key type defaults to ALL on
                            a HTTP session. - REGION_CODE: The country/region from
                            which the request originates. - TLS_JA3_FINGERPRINT: JA3
                            TLS/SSL fingerprint if the client connects using HTTPS,
                            HTTP/2 or HTTP/3. If not available, the key type defaults
                            to ALL. - USER_IP: The IP address of the originating client,
                            which is resolved based on "userIpRequestHeaders" configured
                            with the security policy. If there is no "userIpRequestHeaders"
                            configuration or an IP address cannot be resolved from
                            it, the key type defaults to IP. - TLS_JA4_FINGERPRINT:
                            JA4 TLS/SSL fingerprint if the client connects using HTTPS,
                            HTTP/2 or HTTP/3. If not available, the key type defaults
                            to ALL. Check the EnforceOnKey enum for the list of possible
                            values.'
                          type: string
                        enforceOnKeyConfigs:
                          description: If specified, any combination of values of
                            enforce_on_key_type/enforce_on_key_name is treated as
                            the key on which ratelimit threshold/action is enforced.
                            You can specify up to 3 enforce_on_key_configs. If enforce_on_key_configs
                            is specified, enforce_on_key must not be specified.
                          items:
                            properties:
                              enforceOnKeyName:
                                description: 'Rate limit key name applicable only
                                  for the following key types: HTTP_HEADER -- Name
                                  of the HTTP header whose value is taken as the key
                                  value. HTTP_COOKIE -- Name of the HTTP cookie whose
                                  value is taken as the key value.'
                                type: string
                              enforceOnKeyType:
                                description: 'Determines the key to enforce the rate_limit_threshold
                                  on. Possible values are: - ALL: A single rate limit
                                  threshold is applied to all the requests matching
                                  this rule. This is the default value if "enforceOnKeyConfigs"
                                  is not configured. - IP: The source IP address of
                                  the request is the key. Each IP has this limit enforced
                                  separately. - HTTP_HEADER: The value of the HTTP
                                  header whose name is configured under "enforceOnKeyName".
                                  The key value is truncated to the first 128 bytes
                                  of the header value. If no such header is present
                                  in the request, the key type defaults to ALL. -
                                  XFF_IP: The first IP address (i.e. the originating
                                  client IP address) specified in the list of IPs
                                  under X-Forwarded-For HTTP header. If no such header
                                  is present or the value is not a valid IP, the key
                                  defaults to the source IP address of the request
                                  i.e. key type IP. - HTTP_COOKIE: The value of the
                                  HTTP cookie whose name is configured under "enforceOnKeyName".
                                  The key value is truncated to the first 128 bytes
                                  of the cookie value. If no such cookie is present
                                  in the request, the key type defaults to ALL. -
                                  HTTP_PATH: The URL path of the HTTP request. The
                                  key value is truncated to the first 128 bytes. -
                                  SNI: Server name indication in the TLS session of
                                  the HTTPS request. The key value is truncated to
                                  the first 128 bytes. The key type defaults to ALL
                                  on a HTTP session. - REGION_CODE: The country/region
                                  from which the request originates. - TLS_JA3_FINGERPRINT:
                                  JA3 TLS/SSL fingerprint if the client connects using
                                  HTTPS, HTTP/2 or HTTP/3. If not available, the key
                                  type defaults to ALL. - USER_IP: The IP address
                                  of the originating client, which is resolved based
                                  on "userIpRequestHeaders" configured with the security
                                  policy. If there is no "userIpRequestHeaders" configuration
                                  or an IP address cannot be resolved from it, the
                                  key type defaults to IP. - TLS_JA4_FINGERPRINT:
                                  JA4 TLS/SSL fingerprint if the client connects using
                                  HTTPS, HTTP/2 or HTTP/3. If not available, the key
                                  type defaults to ALL. Check the EnforceOnKeyType
                                  enum for the list of possible values.'
                                type: string
                            type: object
                          type: array
                        enforceOnKeyName:
                          description: 'Rate limit key name applicable only for the
                            following key types: HTTP_HEADER -- Name of the HTTP header
                            whose value is taken as the key value. HTTP_COOKIE --
                            Name of the HTTP cookie whose value is taken as the key
                            value.'
                          type: string
                        exceedAction:
                          description: Action to take for requests that are above
                            the configured rate limit threshold, to either deny with
                            a specified HTTP response code, or redirect to a different
                            endpoint. Valid options are `deny(STATUS)`, where valid
                            values for `STATUS` are 403, 404, 429, and 502, and `redirect`,
                            where the redirect parameters come from `exceedRedirectOptions`
                            below. The `redirect` action is only supported in Global
                            Security Policies of type CLOUD_ARMOR.
                          type: string
                        exceedRedirectOptions:
                          description: Parameters defining the redirect action that
                            is used as the exceed action. Cannot be specified if the
                            exceed action is not redirect. This field is only supported
                            in Global Security Policies of type CLOUD_ARMOR.
                          properties:
                            target:
                              description: Target for the redirect action. This is
                                required if the type is EXTERNAL_302 and cannot be
                                specified for GOOGLE_RECAPTCHA.
                              type: string
                            type:
                              description: 'Type of the redirect action. Possible
                                values are: - GOOGLE_RECAPTCHA: redirect to reCAPTCHA
                                for manual challenge assessment. - EXTERNAL_302: redirect
                                to a different URL via a 302 response. Check the Type
                                enum for the list of possible values.'
                              type: string
                          required:
                          - type
                          type: object
                        rateLimitThreshold:
                          description: Threshold at which to begin ratelimiting.
                          properties:
                            count:
                              description: Number of HTTP(S) requests for calculating
                                the threshold.
                              format: int32
                              type: integer
                            intervalSec:
                              description: Interval over which the threshold is computed.
                              format: int32
                              type: integer
                          required:
                          - count
                          - intervalSec
                          type: object
                      required:
                      - conformAction
                      - exceedAction
                      - rateLimitThreshold
                      type: object
                    redirectOptions:
                      description: Parameters defining the redirect action. Cannot
                        be specified for any other actions. This field is only supported
                        in Global Security Policies of type CLOUD_ARMOR.
                      properties:
                        target:
                          description: Target for the redirect action. This is required
                            if the type is EXTERNAL_302 and cannot be specified for
                            GOOGLE_RECAPTCHA.
                          type: string
                        type:
                          description: 'Type of the redirect action. Possible values
                            are: - GOOGLE_RECAPTCHA: redirect to reCAPTCHA for manual
                            challenge assessment. - EXTERNAL_302: redirect to a different
                            URL via a 302 response. Check the Type enum for the list
                            of possible values.'
                          type: string
                      required:
                      - type
                      type: object
                  required:
                  - action
                  - match
                  - priority
                  type: object
                type: array
              type:
                type: string
            type: object
          status:
            description: ComputeSecurityPolicyStatus defines the config connector
              machine state of ComputeSecurityPolicy
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the object's current state.
                items:
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      type: string
                    message:
                      description: Human-readable message indicating details about
                        last transition.
                      type: string
                    reason:
                      description: Unique, one-word, CamelCase reason for the condition's
                        last transition.
                      type: string
                    status:
                      description: Status is the status of the condition. Can be True,
                        False, Unknown.
                      type: string
                    type:
                      description: Type is the type of the condition.
                      type: string
                  type: object
                type: array
              fingerprint:
                type: string
              observedGeneration:
                description: ObservedGeneration is the generation of the resource
                  that was most recently observed by the Config Connector controller.
                  If this is equal to metadata.generation, then that means that the
                  current reported status reflects the most recent desired state of
                  the resource.
                format: int64
                type: integer
              selfLink:
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
